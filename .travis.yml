language: generic
sudo: required
os:
- linux
env:
  matrix:
  - CONDA_PY=36
  global:
    secure: hAS7x7et/uPTQUSNZOMrb+Lx0oQweaaiyNkoDxN0jF4G/oCiBam+uniZ2VUfEw8TAasJUbDZxWI0O7YkMBRDNUyYHU83pO9FEkwq5pxP2+QI4J174bHpU7W4rh0GmLWeU1p9pXr1TOsORo78O7T1MKA1rvcV3J+znj5EMFW7oVvzPqmnnsL3fr9Xwmy3Ed6CacFD6miK+GWCmBBUmab9obsh2RyI1G7EPd1X1++pSrEcVWVSi+1mynv3EhIYfNn/Oze0JbswI1qYzNFaMZMbPFQb1IT2p6iaIjfpdf3Wuk2bj2ZYpgDAo9I0KMYRllEbxKwA1NxmWA1YSWTKZ7eYiigSZzyCh0dQWmIa2vWyOPR8gxNfdfEsMg/wPyeE0MZXzwg6oFy8aw7aZbpiyOUxQnAM8KxMQyItoLCUM702+JerBFN3vtDTo5vxSsCElsYVQFynO8BP6lMEyefZ+3mIVgVjqqYeiBbiyG3winjWn9CYYSANEQwjVo3/A6zf2i71GjeisOVASGWO3YYTlVXLZ56udtctHR5olZdb6e+a/wGNjzdtYSkXrm76woBc1yIA3wfMTBMwMDB/6YIC2hj9JIabwVL8JK0/4EWGqV0AgVCiCMZSY8ajj3VrxCwvbJuWi7T5j3Au+G5JX5w2gv/ke2+mEGef0ZX82Ex2DGcFkS4=
install:
- |
  echo "Installing a fresh version of Miniconda."
  MINICONDA_URL="https://repo.continuum.io/miniconda"
  MINICONDA_FILE="Miniconda3-latest-$(case $TRAVIS_OS_NAME in (linux) echo Linux;; (osx) echo MacOSX;;esac)-x86_64.sh"
  curl -L -O "${MINICONDA_URL}/${MINICONDA_FILE}"
  bash $MINICONDA_FILE -b
- |
  echo "Configuring conda."
  source $HOME/miniconda3/bin/activate root
  conda install -y conda-build anaconda-client flake8
script:
- |
  flake8 .
  if [ "$TRAVIS_OS_NAME" = "linux" ]; then
      conda build -c intake -c defaults -c conda-forge ./conda
  else
      # Workaround for Travis-CI bug #2: https://github.com/travis-ci/travis-ci/issues/7773
      conda build -c intake -c defaults -c conda-forge --no-test ./conda
  fi
- |
  if [ -n "$TRAVIS_TAG" ]; then
      # If tagged git version, upload package to main channel
      anaconda -t ${ANACONDA_TOKEN} upload -u intake --force `conda build --output ./conda`
  else
      # Otherwise upload package to dev channel
      anaconda -t ${ANACONDA_TOKEN} upload -u intake --label dev --force `conda build --output ./conda`
  fi
notifications:
  email: false
  on_success: change
  on_failure: always
